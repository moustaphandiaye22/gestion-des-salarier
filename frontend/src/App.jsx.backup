import React from "react";
import { Routes, Route, Navigate } from "react-router-dom";

import MainLayout from "./layouts/MainLayout";
import ProtectedRoute from "./components/ProtectedRoute";
import { useAuth } from "./context/AuthContext";

// Auth
import Login from "./pages/Login";
import Register from "./pages/Register";

// Pages
import Dashboard from "./pages/Dashboard";
import CaissierDashboard from "./pages/CaissierDashboard";
import EmployeeList from "./pages/EmployeeList";
import EmployeeForm from "./pages/EmployeeForm";
import EmployeeDetail from "./pages/EmployeeDetail";
import PaiementForm from "./pages/PaiementForm";
import Entreprises from "./pages/Entreprises";
import EntrepriseForm from "./pages/EntrepriseForm";
import EntrepriseDetail from "./pages/EntrepriseDetail";
import Paiements from "./pages/Paiements";
import Bulletins from "./pages/Bulletins";
import CyclesPaie from "./pages/CyclesPaie";
import CyclePaieForm from "./pages/CyclePaieForm";
import ParametreEntreprise from "./pages/ParametreEntreprise";
import ParametresGlobaux from "./pages/ParametresGlobaux";
import Licences from "./pages/Licences";
import Rapports from "./pages/Rapports";
import JournalAudit from "./pages/JournalAudit";
import Utilisateurs from "./pages/Utilisateurs";
import Professions from "./pages/Professions";

// Role-based dashboard component
function RoleBasedDashboard() {
  const { user } = useAuth();

  if (user?.role === 'CAISSIER') {
    return <CaissierDashboard />;
  }

  // Default to admin dashboard for ADMIN_ENTREPRISE, SUPER_ADMIN, EMPLOYE
  return <Dashboard />;
}

function App() {
  return (
    <Routes>
      <Route path="/login" element={<Login />} />
      <Route path="/register" element={<Register />} />

      <Route
        path="/"
        element={
          <ProtectedRoute>
            <MainLayout>
              <RoleBasedDashboard />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/dashboard"
        element={
          <ProtectedRoute>
            <MainLayout>
              <RoleBasedDashboard />
            </MainLayout>
          </ProtectedRoute>
        }
      />


      <Route
        path="/employees"
        element={
          <ProtectedRoute>
            <MainLayout>
              <EmployeeList />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      <Route
        path="/employees/new"
        element={
          <ProtectedRoute>
            <MainLayout>
              <EmployeeForm />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      <Route
        path="/employees/:id/edit"
        element={
          <ProtectedRoute>
            <MainLayout>
              <EmployeeForm />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      <Route
        path="/employees/:id"
        element={
          <ProtectedRoute>
            <MainLayout>
              <EmployeeDetail />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/entreprises"
        element={
          <ProtectedRoute>
            <MainLayout>
              <Entreprises />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      <Route
        path="/entreprises/new"
        element={
          <ProtectedRoute>
            <MainLayout>
              <EntrepriseForm />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      <Route
        path="/entreprises/:id/edit"
        element={
          <ProtectedRoute>
            <MainLayout>
              <EntrepriseForm />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      <Route
        path="/entreprises/:id"
        element={
          <ProtectedRoute>
            <MainLayout>
              <EntrepriseDetail />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/paiements"
        element={
          <ProtectedRoute>
            <MainLayout>
              <Paiements />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      <Route
        path="/paiements/new"
        element={
          <ProtectedRoute>
            <MainLayout>
              <PaiementForm />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      <Route
        path="/paiements/:id/edit"
        element={
          <ProtectedRoute>
            <MainLayout>
              <PaiementForm />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/bulletins"
        element={
          <ProtectedRoute>
            <MainLayout>
              <Bulletins />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/cycles-paie"
      <Route
        path="/cycles-paie/new"
        element={
          <ProtectedRoute>
            <MainLayout>
              <CyclePaieForm />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/cycles-paie/:id/edit"
        element={
          <ProtectedRoute>
            <MainLayout>
              <CyclePaieForm />
            </MainLayout>
          </ProtectedRoute>
        }
      />
        element={
          <ProtectedRoute>
            <MainLayout>
              <CyclesPaie />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/parametres-entreprise"
        element={
          <ProtectedRoute>
            <MainLayout>
              <ParametreEntreprise />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/parametres-globaux"
        element={
          <ProtectedRoute>
            <MainLayout>
              <ParametresGlobaux />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/licences"
        element={
          <ProtectedRoute>
            <MainLayout>
              <Licences />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/rapports"
        element={
          <ProtectedRoute>
            <MainLayout>
              <Rapports />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/journal-audit"
        element={
          <ProtectedRoute>
            <MainLayout>
              <JournalAudit />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/utilisateurs"
        element={
          <ProtectedRoute>
            <MainLayout>
              <Utilisateurs />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route
        path="/professions"
        element={
          <ProtectedRoute>
            <MainLayout>
              <Professions />
            </MainLayout>
          </ProtectedRoute>
        }
      />

      <Route path="*" element={<Navigate to="/" />} />
    </Routes>
  );
}

export default App;
